<!DOCTYPE HTML>
<html class="no-js" xmlns:th="http://www.thymeleaf.org">
<head>
<title>Thymeleaf Fragments</title>
</head>
<body>
	<div th:fragment="navbar">
		<nav class="navbar navbar-expand-lg navbar-light">
			<a class="navbar-brand" href="#">FlyCAGE</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse"
				data-target="#navbarSupportedContent"
				aria-controls="navbarSupportedContent" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item active"><a class="nav-link"
						href="input.html" th:href="@{/}">Analyze <span class="sr-only">(current)</span>
					</a></li>
					<li class="nav-item"><a class="nav-link disabled" href="#">What's
							New?</a></li>
					<li class="nav-item"><a class="nav-link disabled" href="#">APIs</a></li>
					<li class="nav-item"><a class="nav-link disabled" href="#">About</a></li>
					<li class="nav-item"><a class="nav-link" href="help.html"
						th:href="@{/help}">Help</a></li>
				</ul>
				<span class="navbar-text"> in-alpha V0.0.21 </span>
			</div>
		</nav>
	</div>
	<div th:fragment="exception">
		<div th:if="${exception}">
			<div class="alert alert-warning">
				<strong>Invalid Input! </strong> <span
					th:text="'ERROR CODE ' +  ${exception.error.code} + ' - ' + ${exception.error.message}"></span>
			</div>
		</div>
	</div>
	<div th:fragment="gene-form">
		<div class="card panel">
			<div class="card-header panel-header text-center">
				<h2>Input Form</h2>
				<h4>View the correlation data for a specified gene</h4>
			</div>
			<div class="card-body panel-block">
				<div class="container-fluid">
					<div class="row justify-content-center text-center">
						<div class="col-sm-12">
							<form action="#" th:action="@{/}" th:object="${geneForm}"
								method="POST">
								<div class="form-group required">
									<label class="control-label" for="select-species">Select
										Species</label> <select class="form-control" id="select-species"
										th:field="*{geneSpecies}">
										<option value="D. melanogaster" required="required">D.
											melanogaster</option>
									</select> <small id="species-help" class="form-text text-muted">Select
										the species.</small><br /> <small id="species-help-description"
										class="form-text text-muted">Genes compared will only
										be from the selected species.</small><br />
								</div>
								<div class="form-group required">
									<label class="control-label" for="insert-gene">Target
										Gene Name</label> <input type="text" th:field="*{inputIdentifier}"
										class="form-control" id="insert-gene"
										aria-describedby="gene-help" placeholder="e.g. ubx"
										required="required" /> <small id="gene-help"
										class="form-text text-muted">Enter a gene. Format:
										FlyBase ID, CG ID, formal gene name, gene synonyms.</small><br /> <small
										id="gene-help-description" class="form-text text-muted">The
										target gene will be compared to the genome-wide dataset and
										the genes of interest.</small><br />
								</div>



								<div class="form-group">
									<div id="expression-stages" role="tablist"
										aria-multiselectable="true" class="text-left">
										<div class="card form-card"
											th:each="expressionStageGroup : ${expressionStageOptions.expressionStageGroupList}">
											<div class="card-header form-card-header" role="tab"
												th:id="'heading-'+${expressionStageGroup.groupTitle}">
												<h5 class="mb-0">
													<span class="custom-control-description"><a
														data-toggle="collapse" data-parent="#expression-stages"
														th:href="'#collapse-' + ${expressionStageGroup.groupTitle}"
														aria-expanded="true"
														th:aria-controls="'collapse-' + ${expressionStageGroup.groupTitle}"
														th:text="${#strings.capitalize(expressionStageGroup.groupTitle)}">GroupTitle</a></span>
												</h5>
											</div>
											<div th:id="'collapse-' + ${expressionStageGroup.groupTitle}"
												class="collapse" role="tabpanel"
												th:attr="aria-labelledby='heading-' + ${expressionStageGroup.groupTitle}">
												<div class="card-body">
													<div class="row"
														th:each="expressionStage : ${expressionStageGroup.expressionStageList}">
														<div class="col-sm-3">
															<label class="control-label" for=""
																th:text="${expressionStage}">||||expression-stage-text||||</label>
														</div>
														<div class="col-sm-3">
															<input type="number" min="0" max="1"
																th:field="*{customExpression[__${expressionStage}__]}"
																class="form-control" id="custom-input"
																th:id="${expressionStageGroup.groupTitle} + '-' + ${expressionStage} + '-custom-input'"
																aria-describedby="" placeholder="0" />
														</div>
														<div class="col-sm-6">
															<div id="slider" th:id="${expressionStage} + '-slider'">
																<div id="custom-handle"
																	th:id="${expressionStageGroup.groupTitle} + '-' + ${expressionStage} + '-custom-handle'"
																	class="ui-slider-handle"></div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>


								<div class="form-group">
									<label class="control-label" for="insert-gene">Genes of
										Interest</label> <input type="text" th:field="*{genesOfInterest}"
										class="form-control" id="genes-of-interest"
										aria-describedby="genes-of-interest-help"
										placeholder="e.g. grh, en, salm, tsh, antp" /> <small
										id="genes-of-interest-help" class="form-text text-muted">Enter
										genes of interest <u>(optional)</u>. Format: Comma delimited
										list of genes.
									</small><br /> <small id="genes-of-interest-help-description"
										class="form-text text-muted">Each gene in the genes of
										interest list will be directly compared to the target gene.</small><br />
								</div>
								<div class="form-group required">
									<label class="control-label" for="result-count">Choose
										gene result count</label>
									<div class="row">
										<div class="col-sm-3">
											<input type="number" min="2" max="25000"
												th:field="*{geneResultCount} " class="form-control"
												id="result-count" aria-describedby="result-count-help"
												placeholder="100" required="required" />
											<!-- TODO: Max needs to be retrieved from back-end (should be total number of genes to be analyzed), back end needs to ensure no errors occur in validation and processing -->
										</div>
										<div class="col-sm-9">
											<div id="slider">
												<div id="custom-handle" class="ui-slider-handle"></div>
											</div>
										</div>
									</div>
									<small id="result-count-help" class="form-text text-muted">Choose
										the amount of genes that will display on the results page.
										Large amounts will take significantly longer to process and
										load results.</small><br />
								</div>


								<div>
									<div class="form-group required">
										<label class="control-label" for="expression-stages">Choose
											Expression Stages</label>
										<div id="expression-stages" role="tablist"
											aria-multiselectable="true" class="text-left">
											<div class="card form-card"
												th:each="expressionStageGroup : ${expressionStageOptions.expressionStageGroupList}">
												<div class="card-header form-card-header" role="tab"
													th:id="'heading-'+${expressionStageGroup.groupTitle}">
													<h5 class="mb-0">
														<label class="custom-control custom-checkbox"> <input
															type="checkbox"
															th:class="'custom-control-input expression-stage-checkbox ' + ${expressionStageGroup.groupTitle} + '-main-checkbox'" />
															<span class="custom-control-indicator"></span> <span
															class="custom-control-description"><a
																data-toggle="collapse" data-parent="#expression-stages"
																th:href="'#collapse-' + ${expressionStageGroup.groupTitle}"
																aria-expanded="true"
																th:aria-controls="'collapse-' + ${expressionStageGroup.groupTitle}"
																th:text="${#strings.capitalize(expressionStageGroup.groupTitle)}">GroupTitle</a></span>
														</label>
													</h5>
												</div>
												<div
													th:id="'collapse-' + ${expressionStageGroup.groupTitle}"
													class="collapse" role="tabpanel"
													th:attr="aria-labelledby='heading-' + ${expressionStageGroup.groupTitle}">
													<div class="card-body">
														<div
															th:each="expressionStage : ${expressionStageGroup.expressionStageList}"
															class="sub-checkbox-div">
															<label class="custom-control custom-checkbox"> <input
																type="checkbox"
																th:field="*{expressionStages[__${expressionStage}__]}"
																value="true"
																th:class="'custom-control-input expression-stage-checkbox ' + ${expressionStageGroup.groupTitle} + '-sub-checkbox'"
																th:name="${expressionStageGroup.groupTitle} + '-' + ${expressionStage}"
																th:id="${expressionStageGroup.groupTitle} + '-' + ${expressionStage}" />
																<span class="custom-control-indicator"></span> <span
																class="custom-control-description"
																th:text="${expressionStage}">Expression Stage</span>
															</label> <br />
														</div>
													</div>
												</div>
											</div>
										</div>
										<small id="expression-stages-help"
											class="form-text text-muted text-center">Choose
											expression stages.</small><br /> <small
											id="expression-stages-help-description"
											class="form-text text-muted text-center">Comparison
											between genes will be performed only on selected expression
											stages. Click the category text to show corresponding
											expression stages. Click the expression stage checkbox to
											select/deselect stage. Click the category checkbox to
											select/deselect all corresponding expression stages.</small><br />
									</div>
								</div>
								<div class="form-group">
									<label for="text-query-comment">Query Comments</label>
									<textarea class="form-control" th:field="*{queryComment}"
										id="text-query-comment" rows="3"></textarea>
									<small id="comment-help" class="form-text text-muted">These
										comments will be attached to your saved query</small>
								</div>
								<button type="submit" class="btn btn-primary">Submit</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div th:fragment="form-expression-stage-checkbox-selection">
		<script th:inline="javascript">
			//<![CDATA[
			var expressionStageOptions = /*[[${expressionStageOptions}]]*/'ERROR: Unable to import expressionStageOptions';
			var groups = [];
			$.each(expressionStageOptions.expressionStageGroupList, function(i,
					currentElement) {
				groups.push(currentElement.groupTitle);
			});
			console.log(expressionStageOptions);
			//]]>
		</script>
		<script
			th:src="@{/script/form-expression-stage-checkbox-selection.js}"></script>
		<script>
			/*
			 * If no checkboxes are checked (meaning that the form is fresh, and does not have any values saved from previous query)
			 */
			if ($('.expression-stage-checkbox:checked').length == 0) {
				/*
				 * Check every checkbox by default
				 */
				$('.expression-stage-checkbox').prop('checked', true);
			}
		</script>
		<script>
			$("input[class$='sub-checkbox']").each(
					function(index, currentElement) {
						adjustMasterCheckboxes($(currentElement));
					});
		</script>
	</div>
</body>
</html>